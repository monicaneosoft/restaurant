!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zxing/library"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@zxing/ngx-scanner",["exports","@zxing/library","rxjs","rxjs/operators","@angular/core","@angular/common","@angular/forms"],t):t((e.zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.library,e.rxjs,e.Rx.Observable.prototype,e.ng.core,e.ng.common,e.ng.forms)}(this,function(e,o,r,i,t,n,s){"use strict";var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function c(t,s,a,c){return new(a||(a=Promise))(function(e,n){function i(e){try{o(c.next(e))}catch(t){n(t)}}function r(e){try{o(c["throw"](e))}catch(t){n(t)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(i,r)}o((c=c.apply(t,s||[])).next())})}function h(i,r){var o,s,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function n(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,s&&(a=2&e[0]?s["return"]:e[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=r.call(i,c)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var d=function(i){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=500);var n=new o.MultiFormatReader;return n.setHints(e),i.call(this,n,t)||this}return function r(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,i),e.prototype.decodeBitmap=function(e){return this.reader.decodeWithState(e)},e}(function(){function e(e,t){void 0===t&&(t=500),this.reader=e,this.timeBetweenScans=t,this.torchCompatible=new r.BehaviorSubject(!1)}return e.prototype.decodeFromInputVideoDevice=function(r,o,s){return c(this,void 0,void 0,function(){var t,n,i;return h(this,function(e){switch(e.label){case 0:if(this.reset(),this.prepareVideoElement(s),void 0!==o&&(this.deviceId=o),t={audio:!1,video:void 0===o?{facingMode:{exact:"environment"}}:{deviceId:{exact:o}}},"undefined"==typeof navigator)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(t)];case 2:return n=e.sent(),this.startDecodeFromStream(n,r),[3,4];case 3:return i=e.sent(),console.error(i),[3,4];case 4:return[2]}})})},e.prototype.startDecodeFromStream=function(e,t){this.stream=e,this.checkTorchCompatibility(this.stream),this.bindVideoSrc(this.videoElement,this.stream),this.bindEvents(this.videoElement,t)},e.prototype.bindVideoSrc=function(e,t){try{e.srcObject=t}catch(n){e.src=window.URL.createObjectURL(t)}},e.prototype.unbindVideoSrc=function(e){try{e.srcObject=null}catch(t){e.src=""}},e.prototype.bindEvents=function(e,t){var n=this;void 0!==t&&(this.videoPlayingEventListener=function(){return n.decodingStream=n.decodeWithDelay(n.timeBetweenScans).pipe(i.catchError(function(e,t){return n.handleDecodeStreamError(e,t)})).subscribe(function(e){return t(e)})}),e.addEventListener("playing",this.videoPlayingEventListener),this.videoLoadedMetadataEventListener=function(){return e.play()},e.addEventListener("loadedmetadata",this.videoLoadedMetadataEventListener)},e.prototype.checkTorchCompatibility=function(i){return c(this,void 0,void 0,function(){var t,n;return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.track=i.getVideoTracks()[0],[4,new ImageCapture(this.track).getPhotoCapabilities()];case 1:return t=e.sent(),n=!!t.torch||"fillLightMode"in t&&0!==t.fillLightMode.length,this.torchCompatible.next(n),[3,3];case 2:return e.sent(),this.torchCompatible.next(!1),[3,3];case 3:return[2]}})})},e.prototype.setTorch=function(e){this.torchCompatible.value&&(e?this.track.applyConstraints({advanced:[{torch:!0}]}):this.restart())},Object.defineProperty(e.prototype,"torchAvailable",{get:function(){return this.torchCompatible.asObservable()},enumerable:!0,configurable:!0}),e.prototype.prepareVideoElement=function(e){e||"undefined"==typeof document||((e=document.createElement("video")).width=200,e.height=200),this.videoElement=e},e.prototype.decodeWithDelay=function(n){var i=this;return void 0===n&&(n=500),r.Observable.create(function(t){var e=setInterval(function(){try{t.next(i.decode())}catch(e){t.error(e)}},n);return function(){return clearInterval(e)}})},e.prototype.decode=function(){var e=this.createBinaryBitmap(this.videoElement||this.imageElement);return this.decodeBitmap(e)},e.prototype.decodeBitmap=function(e){return this.reader.decode(e)},e.prototype.handleDecodeStreamError=function(e,t){if(e instanceof o.NotFoundException||e instanceof o.ChecksumException||e instanceof o.FormatException)return t;throw e},e.prototype.createBinaryBitmap=function(e){undefined===this.canvasElementContext&&this.prepareCaptureCanvas(),this.canvasElementContext.drawImage(e,0,0);var t=new o.HTMLCanvasElementLuminanceSource(this.canvasElement),n=new o.HybridBinarizer(t);return new o.BinaryBitmap(n)},e.prototype.prepareCaptureCanvas=function(){if("undefined"==typeof document)return this.canvasElement=undefined,void(this.canvasElementContext=undefined);var e,t,n=document.createElement("canvas");"undefined"!=typeof this.videoElement&&(e=this.videoElement.videoWidth,t=this.videoElement.videoHeight),"undefined"!=typeof this.imageElement&&(e=this.imageElement.naturalWidth||this.imageElement.width,t=this.imageElement.naturalHeight||this.imageElement.height),n.style.width=e+"px",n.style.height=t+"px",n.width=e,n.height=t,this.canvasElement=n,this.canvasElementContext=n.getContext("2d")},e.prototype.stop=function(){this.decodingStream&&this.decodingStream.unsubscribe(),this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=undefined)},e.prototype.reset=function(){this.stop(),this.videoElement&&("undefined"!=typeof this.videoPlayEndedEventListener&&this.videoElement.removeEventListener("ended",this.videoPlayEndedEventListener),"undefined"!=typeof this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),"undefined"!=typeof this.videoLoadedMetadataEventListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoLoadedMetadataEventListener),this.unbindVideoSrc(this.videoElement),this.videoElement.removeAttribute("src"),this.videoElement=undefined),this.imageElement&&(undefined!==this.videoPlayEndedEventListener&&this.imageElement.removeEventListener("load",this.imageLoadedEventListener),this.imageElement.src=undefined,this.imageElement.removeAttribute("src"),this.imageElement=undefined),this.canvasElementContext=undefined,this.canvasElement=undefined},e.prototype.restart=function(){this.decodeFromInputVideoDevice(undefined,this.deviceId,this.videoElement)},e}()),u=function(){function e(){this.scannerEnabled=!0,this.autofocusEnabled=!0,this.previewFitMode="cover",this.torchCompatible=new t.EventEmitter,this.scanSuccess=new t.EventEmitter,this.scanFailure=new t.EventEmitter,this.scanError=new t.EventEmitter,this.scanComplete=new t.EventEmitter,this.camerasFound=new t.EventEmitter,this.camerasNotFound=new t.EventEmitter,this.permissionResponse=new t.EventEmitter,this.hasDevices=new t.EventEmitter,this._hints=new Map,this.hasNavigator="undefined"!=typeof navigator,this.isMediaDevicesSuported=this.hasNavigator&&!!navigator.mediaDevices,this.isEnumerateDevicesSuported=!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices),this.formats=[o.BarcodeFormat.QR_CODE]}return Object.defineProperty(e.prototype,"_hasDevices",{set:function(e){this.hasDevices.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formats",{get:function(){return this.hints.get(2)},set:function(e){var t=this;if("string"==typeof e)throw new Error("Invalid formats, make sure the [formats] input is a binding.");var n=e.map(function(e){return t.getBarcodeFormat(e)});this.hints.set(2,n),this.refreshCodeReader()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hints",{get:function(){return this._hints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"torch",{set:function(e){this.codeReader.setTorch(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tryHarder",{get:function(){return this.hints.get(3)},set:function(e){e?this.hints.set(3,!0):this.hints["delete"](3),this.refreshCodeReader()},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.scannerEnabled&&(this.scannerEnabled?this.videoInputDevice&&this.scan(this.videoInputDevice.deviceId):this.resetCodeReader()),e.device&&(this.device?this.changeDevice(this.device):(console.warn("zxing-scanner","device","Unselected device."),this.resetCodeReader()))},e.prototype.ngAfterViewInit=function(){return c(this,void 0,void 0,function(){var t,n=this;return h(this,function(e){switch(e.label){case 0:return this.previewElemRef?(this.previewElemRef.nativeElement.setAttribute("autoplay",!1),this.previewElemRef.nativeElement.setAttribute("muted",!0),this.previewElemRef.nativeElement.setAttribute("playsinline",!0),this.previewElemRef.nativeElement.setAttribute("autofocus",this.autofocusEnabled),[4,this.askForPermission()]):(console.warn("zxing-scanner","Preview element not found!"),[2]);case 1:return t=e.sent(),this.enumarateVideoDevices().then(function(e){e&&0<e.length?(n._hasDevices=!0,n.camerasFound.next(e)):(n._hasDevices=!1,n.camerasNotFound.next())}),!0!==t?[2]:(this.startScan(this.videoInputDevice),this.codeReader.torchAvailable.subscribe(function(e){n.torchCompatible.emit(e)}),[2])}})})},e.prototype.ngOnDestroy=function(){this.resetCodeReader()},e.prototype.changeDevice=function(e){this.resetCodeReader(),this.videoInputDevice=e,this.startScan(e)},e.prototype.changeDeviceById=function(e){this.changeDevice(this.getDeviceById(e))},e.prototype.getDeviceById=function(t){return this.videoInputDevices.find(function(e){return e.deviceId===t})},e.prototype.setPermission=function(e){return this.hasPermission=e,this.permissionResponse.next(e),this.permissionResponse},e.prototype.askForPermission=function(){return c(this,void 0,void 0,function(){var n,i,r;return h(this,function(e){switch(e.label){case 0:if(!this.hasNavigator)return console.error("zxing-scanner","askForPermission","Can't ask permission, navigator is not present."),this.setPermission(null),[2,this.hasPermission];if(!this.isMediaDevicesSuported)return console.error("zxing-scanner","askForPermission","Can't get user media, this is not supported."),this.setPermission(null),[2,this.hasPermission];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 2:return n=e.sent(),[3,4];case 3:return i=e.sent(),[2,this.handlePermissionException(i)];case 4:try{this.codeReader.bindVideoSrc(this.previewElemRef.nativeElement,n),n.getVideoTracks().forEach(function(e){e.stop()}),this.codeReader.unbindVideoSrc(this.previewElemRef.nativeElement),r=!0,this.setPermission(r)}catch(t){console.error("zxing-scanner","askForPermission",t),r=null,this.setPermission(r)}return[2,r]}})})},e.prototype.handlePermissionException=function(e){var t;switch(console.warn("zxing-scanner","askForPermission",e),e.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",e.message),t=null,this._hasDevices=null;break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",e.message),t=!1,this._hasDevices=!0;break;case"NotFoundError":console.warn("@zxing/ngx-scanner",e.message),t=null,this._hasDevices=!1,this.camerasNotFound.next(e);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),t=null,this._hasDevices=!1,this.camerasNotFound.next(e);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",e),t=null}return this.setPermission(t),this.permissionResponse.error(e),t},e.prototype.scan=function(e){var t=this;try{this.codeReader.decodeFromInputVideoDevice(function(e){e?t.dispatchScanSuccess(e):t.dispatchScanFailure(),t.dispatchScanComplete(e)},e,this.previewElemRef.nativeElement)}catch(n){this.dispatchScanError(n),this.dispatchScanComplete(undefined)}},e.prototype.startScan=function(e){this.scannerEnabled&&e&&this.scan(e.deviceId)},e.prototype.resetCodeReader=function(){this.codeReader&&this.codeReader.reset()},e.prototype.restartScan=function(){this.resetCodeReader(),this.startScan(this.device)},e.prototype.refreshCodeReader=function(){this.resetCodeReader(),this.codeReader=new d(this.hints),this.startScan(this.device)},e.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},e.prototype.dispatchScanFailure=function(){this.scanFailure.next()},e.prototype.dispatchScanError=function(e){this.scanError.next(e)},e.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},e.prototype.enumarateVideoDevices=function(){return c(this,void 0,void 0,function(){var n,r,o,s,a,c,d,u;return h(this,function(e){switch(e.label){case 0:return this.hasNavigator?this.isEnumerateDevicesSuported?[4,navigator.mediaDevices.enumerateDevices()]:(console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, method not supported."),[2]):(console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, navigator is not present."),[2]);case 1:o=e.sent(),this.videoInputDevices=[];try{for(s=function i(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(o),a=s.next();!a.done;a=s.next()){for(u in c=a.value,d={},c)d[u]=c[u];"video"===d.kind&&(d.kind="videoinput"),d.deviceId||(d.deviceId=d.id),d.label||(d.label="Camera (no permission 🚫)"),"videoinput"===d.kind&&this.videoInputDevices.push(d)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s["return"])&&r.call(s)}finally{if(n)throw n.error}}return[2,this.videoInputDevices]}})})},e.prototype.getBarcodeFormat=function(e){return"string"==typeof e?o.BarcodeFormat[e.trim().toUpperCase()]:e},e}();u.decorators=[{type:t.Component,args:[{selector:"zxing-scanner",template:'<video #preview [style.object-fit]="previewFitMode">\n  <p>\n    Your browser does not support this feature, please try to upgrade it.\n  </p>\n  <p>\n    Seu navegador não suporta este recurso, por favor tente atualizá-lo.\n  </p>\n</video>\n',styles:[":host{display:block}video{width:100%;height:auto;-o-object-fit:contain;object-fit:contain}"],changeDetection:t.ChangeDetectionStrategy.OnPush}]}],u.ctorParameters=function(){return[]},u.propDecorators={previewElemRef:[{type:t.ViewChild,args:["preview"]}],scannerEnabled:[{type:t.Input}],device:[{type:t.Input}],autofocusEnabled:[{type:t.Input}],previewFitMode:[{type:t.Input}],torchCompatible:[{type:t.Output}],scanSuccess:[{type:t.Output}],scanFailure:[{type:t.Output}],scanError:[{type:t.Output}],scanComplete:[{type:t.Output}],camerasFound:[{type:t.Output}],camerasNotFound:[{type:t.Output}],permissionResponse:[{type:t.Output}],hasDevices:[{type:t.Output}],formats:[{type:t.Input}],torch:[{type:t.Input}],tryHarder:[{type:t.Input}]};var p=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e}();p.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,s.FormsModule],declarations:[u],exports:[u]}]}],e.ZXingScannerModule=p,e.ZXingScannerComponent=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map
